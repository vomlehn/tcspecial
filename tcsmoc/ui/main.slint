// TCSpecial Mission Operations Center GUI
// Black on white theme as per design specification

import { Button, LineEdit, ComboBox, GridBox, VerticalBox, HorizontalBox, GroupBox, ScrollView } from "std-widgets.slint";

// DH Panel state
export enum DHState {
    Idle,
    Active,
    Stopped,
}

// DH Type
export enum DHTypeEnum {
    Network,
    Device,
}

// Data Handler Panel component
component DHPanel inherits Rectangle {
    in property <int> dh-id;
    in-out property <DHState> state: DHState.Idle;
    in-out property <DHTypeEnum> dh-type: DHTypeEnum.Network;
    in-out property <string> config-name: "";
    in-out property <string> status: "Idle";
    in-out property <string> stats: "";
    in property <bool> connected: false;

    callback start-clicked();
    callback stop-clicked();
    callback query-clicked();

    border-color: black;
    border-width: 1px;
    background: state == DHState.Active ? #e8f5e9 :
                state == DHState.Stopped ? #fff3e0 : white;
    min-width: 220px;
    min-height: 180px;

    VerticalBox {
        padding: 8px;
        spacing: 6px;

        HorizontalBox {
            alignment: space-between;
            Text {
                text: "DH" + dh-id;
                font-size: 16px;
                font-weight: 700;
                color: black;
            }
            Text {
                text: state == DHState.Active ? "●" :
                      state == DHState.Stopped ? "○" : "◯";
                color: state == DHState.Active ? green :
                       state == DHState.Stopped ? orange : gray;
                font-size: 16px;
            }
        }

        Rectangle {
            height: 1px;
            background: black;
        }

        HorizontalBox {
            spacing: 4px;
            Text { text: "Type:"; color: black; vertical-alignment: center; }
            ComboBox {
                model: ["Network", "Device"];
                current-index: dh-type == DHTypeEnum.Network ? 0 : 1;
                enabled: state == DHState.Idle;
                selected(idx) => {
                    dh-type = idx == 0 ? DHTypeEnum.Network : DHTypeEnum.Device;
                }
            }
        }

        HorizontalBox {
            spacing: 4px;
            Text { text: "Config:"; color: black; vertical-alignment: center; }
            LineEdit {
                text <=> config-name;
                enabled: state == DHState.Idle;
            }
        }

        HorizontalBox {
            spacing: 4px;
            Button {
                text: "Start";
                enabled: connected && (state == DHState.Idle || state == DHState.Stopped);
                clicked => { start-clicked(); }
            }
            Button {
                text: "Stop";
                enabled: connected && state == DHState.Active;
                clicked => { stop-clicked(); }
            }
            Button {
                text: "Query";
                enabled: connected && state == DHState.Active;
                clicked => { query-clicked(); }
            }
        }

        Rectangle {
            height: 1px;
            background: black;
        }

        Text {
            text: "Status: " + status;
            color: black;
            font-size: 12px;
        }

        Text {
            text: stats;
            color: #333;
            font-size: 10px;
            wrap: word-wrap;
        }
    }
}

// Main application window
export component MainWindow inherits Window {
    title: "TCSpecial Mission Operations Center";
    min-width: 1024px;
    min-height: 768px;
    background: white;

    // Connection state
    in-out property <bool> connected: false;
    in-out property <string> remote-addr: "127.0.0.1:5000";
    in-out property <string> local-addr: "127.0.0.1:5100";
    in-out property <string> status-message: "Not connected";
    in-out property <string> beacon-interval: "10000";
    in-out property <string> arm-key: "12345";

    // DH states
    in-out property <DHState> dh0-state: DHState.Idle;
    in-out property <DHState> dh1-state: DHState.Idle;
    in-out property <DHState> dh2-state: DHState.Idle;
    in-out property <DHState> dh3-state: DHState.Idle;
    in-out property <DHState> dh4-state: DHState.Idle;
    in-out property <DHState> dh5-state: DHState.Idle;
    in-out property <DHState> dh6-state: DHState.Idle;
    in-out property <DHState> dh7-state: DHState.Idle;

    // DH configs
    in-out property <string> dh0-config: "localhost:5000:tcp";
    in-out property <string> dh1-config: "localhost:5001:udp";
    in-out property <string> dh2-config: "/dev/urandom";
    in-out property <string> dh3-config: "localhost:5003:udp";
    in-out property <string> dh4-config: "localhost:5004";
    in-out property <string> dh5-config: "localhost:5005";
    in-out property <string> dh6-config: "localhost:5006";
    in-out property <string> dh7-config: "localhost:5007";

    // DH types
    in-out property <DHTypeEnum> dh0-type: DHTypeEnum.Network;
    in-out property <DHTypeEnum> dh1-type: DHTypeEnum.Network;
    in-out property <DHTypeEnum> dh2-type: DHTypeEnum.Device;
    in-out property <DHTypeEnum> dh3-type: DHTypeEnum.Network;
    in-out property <DHTypeEnum> dh4-type: DHTypeEnum.Network;
    in-out property <DHTypeEnum> dh5-type: DHTypeEnum.Network;
    in-out property <DHTypeEnum> dh6-type: DHTypeEnum.Network;
    in-out property <DHTypeEnum> dh7-type: DHTypeEnum.Network;

    // DH statuses
    in-out property <string> dh0-status: "Idle";
    in-out property <string> dh1-status: "Idle";
    in-out property <string> dh2-status: "Idle";
    in-out property <string> dh3-status: "Idle";
    in-out property <string> dh4-status: "Idle";
    in-out property <string> dh5-status: "Idle";
    in-out property <string> dh6-status: "Idle";
    in-out property <string> dh7-status: "Idle";

    // DH stats
    in-out property <string> dh0-stats: "";
    in-out property <string> dh1-stats: "";
    in-out property <string> dh2-stats: "";
    in-out property <string> dh3-stats: "";
    in-out property <string> dh4-stats: "";
    in-out property <string> dh5-stats: "";
    in-out property <string> dh6-stats: "";
    in-out property <string> dh7-stats: "";

    // Callbacks for actions
    callback connect-clicked();
    callback disconnect-clicked();
    callback ping-clicked();
    callback configure-clicked();
    callback arm-clicked();
    callback restart-clicked();
    callback dh-start(int, DHTypeEnum, string);
    callback dh-stop(int);
    callback dh-query(int);

    VerticalBox {
        padding: 10px;
        spacing: 10px;

        // Command Interpreter section
        GroupBox {
            title: "Command Interpreter";

            VerticalBox {
                spacing: 8px;

                HorizontalBox {
                    spacing: 8px;
                    Text { text: "Remote:"; color: black; vertical-alignment: center; }
                    LineEdit {
                        text <=> remote-addr;
                        enabled: !connected;
                    }
                    Text { text: "Local:"; color: black; vertical-alignment: center; }
                    LineEdit {
                        text <=> local-addr;
                        enabled: !connected;
                    }
                    Button {
                        text: connected ? "Disconnect" : "Connect";
                        clicked => {
                            if (connected) {
                                disconnect-clicked();
                            } else {
                                connect-clicked();
                            }
                        }
                    }
                }

                HorizontalBox {
                    spacing: 8px;
                    Button {
                        text: "Ping";
                        enabled: connected;
                        clicked => { ping-clicked(); }
                    }
                    Rectangle { width: 10px; }
                    Text { text: "Beacon (ms):"; color: black; vertical-alignment: center; }
                    LineEdit {
                        text <=> beacon-interval;
                        enabled: connected;
                        width: 60px;
                    }
                    Button {
                        text: "Configure";
                        enabled: connected;
                        clicked => { configure-clicked(); }
                    }
                    Rectangle { width: 10px; }
                    Text { text: "Arm Key:"; color: black; vertical-alignment: center; }
                    LineEdit {
                        text <=> arm-key;
                        enabled: connected;
                        width: 60px;
                    }
                    Button {
                        text: "Arm";
                        enabled: connected;
                        clicked => { arm-clicked(); }
                    }
                    Button {
                        text: "Restart";
                        enabled: connected;
                        clicked => { restart-clicked(); }
                    }
                }

                HorizontalBox {
                    spacing: 4px;
                    Text { text: "Status:"; color: black; font-weight: 600; }
                    Text { text: status-message; color: black; }
                }
            }
        }

        // Data Handlers section
        GroupBox {
            title: "Data Handlers";

            GridBox {
                spacing: 10px;

                // Row 0: DH0-DH3
                Row {
                    DHPanel {
                        dh-id: 0;
                        state <=> dh0-state;
                        dh-type <=> dh0-type;
                        config-name <=> dh0-config;
                        status: dh0-status;
                        stats: dh0-stats;
                        connected: connected;
                        start-clicked => { dh-start(0, dh0-type, dh0-config); }
                        stop-clicked => { dh-stop(0); }
                        query-clicked => { dh-query(0); }
                    }
                    DHPanel {
                        dh-id: 1;
                        state <=> dh1-state;
                        dh-type <=> dh1-type;
                        config-name <=> dh1-config;
                        status: dh1-status;
                        stats: dh1-stats;
                        connected: connected;
                        start-clicked => { dh-start(1, dh1-type, dh1-config); }
                        stop-clicked => { dh-stop(1); }
                        query-clicked => { dh-query(1); }
                    }
                    DHPanel {
                        dh-id: 2;
                        state <=> dh2-state;
                        dh-type <=> dh2-type;
                        config-name <=> dh2-config;
                        status: dh2-status;
                        stats: dh2-stats;
                        connected: connected;
                        start-clicked => { dh-start(2, dh2-type, dh2-config); }
                        stop-clicked => { dh-stop(2); }
                        query-clicked => { dh-query(2); }
                    }
                    DHPanel {
                        dh-id: 3;
                        state <=> dh3-state;
                        dh-type <=> dh3-type;
                        config-name <=> dh3-config;
                        status: dh3-status;
                        stats: dh3-stats;
                        connected: connected;
                        start-clicked => { dh-start(3, dh3-type, dh3-config); }
                        stop-clicked => { dh-stop(3); }
                        query-clicked => { dh-query(3); }
                    }
                }

                // Row 1: DH4-DH7
                Row {
                    DHPanel {
                        dh-id: 4;
                        state <=> dh4-state;
                        dh-type <=> dh4-type;
                        config-name <=> dh4-config;
                        status: dh4-status;
                        stats: dh4-stats;
                        connected: connected;
                        start-clicked => { dh-start(4, dh4-type, dh4-config); }
                        stop-clicked => { dh-stop(4); }
                        query-clicked => { dh-query(4); }
                    }
                    DHPanel {
                        dh-id: 5;
                        state <=> dh5-state;
                        dh-type <=> dh5-type;
                        config-name <=> dh5-config;
                        status: dh5-status;
                        stats: dh5-stats;
                        connected: connected;
                        start-clicked => { dh-start(5, dh5-type, dh5-config); }
                        stop-clicked => { dh-stop(5); }
                        query-clicked => { dh-query(5); }
                    }
                    DHPanel {
                        dh-id: 6;
                        state <=> dh6-state;
                        dh-type <=> dh6-type;
                        config-name <=> dh6-config;
                        status: dh6-status;
                        stats: dh6-stats;
                        connected: connected;
                        start-clicked => { dh-start(6, dh6-type, dh6-config); }
                        stop-clicked => { dh-stop(6); }
                        query-clicked => { dh-query(6); }
                    }
                    DHPanel {
                        dh-id: 7;
                        state <=> dh7-state;
                        dh-type <=> dh7-type;
                        config-name <=> dh7-config;
                        status: dh7-status;
                        stats: dh7-stats;
                        connected: connected;
                        start-clicked => { dh-start(7, dh7-type, dh7-config); }
                        stop-clicked => { dh-stop(7); }
                        query-clicked => { dh-query(7); }
                    }
                }
            }
        }
    }
}
