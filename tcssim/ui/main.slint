import { Button, GroupBox, LineEdit, VerticalBox, HorizontalBox, SpinBox, ScrollView, GridBox } from "std-widgets.slint";

component PayloadPanel inherits Rectangle {
    in property <string> payload-name: "Payload 0";
    in property <string> payload-config: "TCP localhost:5000";
    in property <string> payload-status: "Stopped";
    in-out property <int> packet-size: 12;
    in-out property <int> packet-interval: 1000;
    in property <string> last-sent-time: "--:--:--";
    in property <string> last-sent-data: "";
    in property <string> last-recv-time: "--:--:--";
    in property <string> last-recv-data: "";
    in property <int> packets-sent: 0;
    in property <int> packets-recv: 0;

    callback start-clicked();
    callback stop-clicked();
    callback config-changed();

    background: #f0f0f0;
    border-color: #808080;
    border-width: 1px;
    min-height: 200px;

    VerticalBox {
        padding: 8px;
        spacing: 4px;

        HorizontalBox {
            Text {
                text: payload-name;
                font-size: 14px;
                font-weight: 700;
            }
            Text {
                text: payload-status;
                color: payload-status == "Running" ? black : red;
                font-weight: payload-status == "Running" ? 400 : 700;
            }
        }

        Text {
            text: "Config: " + payload-config;
            font-size: 11px;
        }

        HorizontalBox {
            spacing: 4px;
            Text { text: "Packet Size:"; vertical-alignment: center; font-size: 11px; }
            SpinBox {
                value <=> packet-size;
                minimum: 1;
                maximum: 1024;
                edited => { config-changed(); }
            }
            Text { text: "bytes"; vertical-alignment: center; font-size: 11px; }
        }

        HorizontalBox {
            spacing: 4px;
            Text { text: "Interval:"; vertical-alignment: center; font-size: 11px; }
            SpinBox {
                value <=> packet-interval;
                minimum: 0;
                maximum: 10000;
                edited => { config-changed(); }
            }
            Text { text: "ms"; vertical-alignment: center; font-size: 11px; }
        }

        HorizontalBox {
            spacing: 4px;
            Button {
                text: "Start";
                clicked => { start-clicked(); }
            }
            Button {
                text: "Stop";
                clicked => { stop-clicked(); }
            }
        }

        GroupBox {
            title: "Last Sent";
            VerticalBox {
                Text { text: "Time: " + last-sent-time; font-size: 10px; }
                Text { text: "Data: " + last-sent-data; font-size: 10px; }
            }
        }

        GroupBox {
            title: "Last Received";
            VerticalBox {
                Text { text: "Time: " + last-recv-time; font-size: 10px; }
                Text { text: "Data: " + last-recv-data; font-size: 10px; }
            }
        }

        HorizontalBox {
            Text { text: "Sent: " + packets-sent + " pkts"; font-size: 10px; }
            Text { text: "Recv: " + packets-recv + " pkts"; font-size: 10px; }
        }
    }
}

export component MainWindow inherits Window {
    title: "TCSpecial Payload Simulator";
    min-width: 800px;
    min-height: 600px;
    background: white;

    // Payload 0 properties
    in-out property <string> p0-status: "Stopped";
    in-out property <int> p0-packet-size: 12;
    in-out property <int> p0-interval: 1000;
    in-out property <string> p0-last-sent-time: "--:--:--";
    in-out property <string> p0-last-sent-data: "";
    in-out property <string> p0-last-recv-time: "--:--:--";
    in-out property <string> p0-last-recv-data: "";
    in-out property <int> p0-packets-sent: 0;
    in-out property <int> p0-packets-recv: 0;

    // Payload 1 properties
    in-out property <string> p1-status: "Stopped";
    in-out property <int> p1-packet-size: 11;
    in-out property <int> p1-interval: 1000;
    in-out property <string> p1-last-sent-time: "--:--:--";
    in-out property <string> p1-last-sent-data: "";
    in-out property <string> p1-last-recv-time: "--:--:--";
    in-out property <string> p1-last-recv-data: "";
    in-out property <int> p1-packets-sent: 0;
    in-out property <int> p1-packets-recv: 0;

    // Payload 2 properties
    in-out property <string> p2-status: "Stopped";
    in-out property <int> p2-packet-size: 1;
    in-out property <int> p2-interval: 0;
    in-out property <string> p2-last-sent-time: "--:--:--";
    in-out property <string> p2-last-sent-data: "";
    in-out property <string> p2-last-recv-time: "--:--:--";
    in-out property <string> p2-last-recv-data: "";
    in-out property <int> p2-packets-sent: 0;
    in-out property <int> p2-packets-recv: 0;

    // Payload 3 properties
    in-out property <string> p3-status: "Stopped";
    in-out property <int> p3-packet-size: 15;
    in-out property <int> p3-interval: 500;
    in-out property <string> p3-last-sent-time: "--:--:--";
    in-out property <string> p3-last-sent-data: "";
    in-out property <string> p3-last-recv-time: "--:--:--";
    in-out property <string> p3-last-recv-data: "";
    in-out property <int> p3-packets-sent: 0;
    in-out property <int> p3-packets-recv: 0;

    callback start-payload(int);
    callback stop-payload(int);
    callback config-payload(int, int, int);
    callback quit-clicked();

    VerticalBox {
        padding: 10px;
        spacing: 10px;

        Text {
            text: "Simulated Payloads";
            font-size: 18px;
            font-weight: 700;
            horizontal-alignment: center;
        }

        ScrollView {
            GridBox {
                spacing: 10px;

                Row {
                    PayloadPanel {
                        payload-name: "Payload 0 (DH0)";
                        payload-config: "TCP localhost:5000";
                        payload-status: p0-status;
                        packet-size <=> p0-packet-size;
                        packet-interval <=> p0-interval;
                        last-sent-time: p0-last-sent-time;
                        last-sent-data: p0-last-sent-data;
                        last-recv-time: p0-last-recv-time;
                        last-recv-data: p0-last-recv-data;
                        packets-sent: p0-packets-sent;
                        packets-recv: p0-packets-recv;
                        start-clicked => { start-payload(0); }
                        stop-clicked => { stop-payload(0); }
                        config-changed => { config-payload(0, p0-packet-size, p0-interval); }
                    }

                    PayloadPanel {
                        payload-name: "Payload 1 (DH1)";
                        payload-config: "UDP localhost:5001";
                        payload-status: p1-status;
                        packet-size <=> p1-packet-size;
                        packet-interval <=> p1-interval;
                        last-sent-time: p1-last-sent-time;
                        last-sent-data: p1-last-sent-data;
                        last-recv-time: p1-last-recv-time;
                        last-recv-data: p1-last-recv-data;
                        packets-sent: p1-packets-sent;
                        packets-recv: p1-packets-recv;
                        start-clicked => { start-payload(1); }
                        stop-clicked => { stop-payload(1); }
                        config-changed => { config-payload(1, p1-packet-size, p1-interval); }
                    }
                }

                Row {
                    PayloadPanel {
                        payload-name: "Payload 2 (DH2)";
                        payload-config: "Device /dev/urandom";
                        payload-status: p2-status;
                        packet-size <=> p2-packet-size;
                        packet-interval <=> p2-interval;
                        last-sent-time: p2-last-sent-time;
                        last-sent-data: p2-last-sent-data;
                        last-recv-time: p2-last-recv-time;
                        last-recv-data: p2-last-recv-data;
                        packets-sent: p2-packets-sent;
                        packets-recv: p2-packets-recv;
                        start-clicked => { start-payload(2); }
                        stop-clicked => { stop-payload(2); }
                        config-changed => { config-payload(2, p2-packet-size, p2-interval); }
                    }

                    PayloadPanel {
                        payload-name: "Payload 3 (DH3)";
                        payload-config: "UDP localhost:5003";
                        payload-status: p3-status;
                        packet-size <=> p3-packet-size;
                        packet-interval <=> p3-interval;
                        last-sent-time: p3-last-sent-time;
                        last-sent-data: p3-last-sent-data;
                        last-recv-time: p3-last-recv-time;
                        last-recv-data: p3-last-recv-data;
                        packets-sent: p3-packets-sent;
                        packets-recv: p3-packets-recv;
                        start-clicked => { start-payload(3); }
                        stop-clicked => { stop-payload(3); }
                        config-changed => { config-payload(3, p3-packet-size, p3-interval); }
                    }
                }
            }
        }

        HorizontalBox {
            Rectangle { }
            Button {
                text: "Quit All";
                clicked => { quit-clicked(); }
            }
        }
    }
}
