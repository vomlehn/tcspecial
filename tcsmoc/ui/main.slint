import { Button, GroupBox, LineEdit, ListView, GridBox, StandardListView, ScrollView } from "std-widgets.slint";

component DHPanel inherits Rectangle {
    in property <string> dh-name: "DH0";
    in property <string> dh-config: "UDP localhost:5000";
    in property <string> dh-status: "Stopped";
    in property <int> packet-size: 12;
    in property <int> packet-interval: 1000;
    in property <string> last-sent-time: "--:--:--";
    in property <string> last-sent-data: "";
    in property <string> last-recv-time: "--:--:--";
    in property <string> last-recv-data: "";
    in property <int> bytes-sent: 0;
    in property <int> bytes-recv: 0;

    callback start-clicked();
    callback stop-clicked();

    background: #f0f0f0;
    border-color: #808080;
    border-width: 1px;
    min-height: 180px;

    VerticalLayout {
        padding: 8px;
        spacing: 4px;
        height: 200px;

        HorizontalLayout {
            Text {
                text: dh-name;
                font-size: 14px;
                font-weight: 700;
            }
            Text {
                text: dh-status;
                color: dh-status == "Active" ? #008000 : #808080;
            }
        }

        HorizontalLayout {
            height: 12px;
            Text {
                text: "Config: " + dh-config;
                font-size: 11px;
            }
        }

        HorizontalLayout {
            Text { text: "Packet Size: " + packet-size + " bytes"; font-size: 11px; }
            Text { text: "Interval: " + packet-interval + " ms"; font-size: 11px; }
        }

        HorizontalLayout {
            spacing: 4px;
            Button {
                text: "Start";
                clicked => { start-clicked(); }
            }
            Button {
                text: "Stop";
                clicked => { stop-clicked(); }
            }
        }

        GroupBox {
            title: "Last Sent";
            HorizontalLayout {
                Text { text: last-sent-time; font-size: 10px; }
                Text { text: last-sent-data; font-size: 10px; }
            }
        }

        GroupBox {
            title: "Last Received";
            HorizontalLayout {
                Text { text: last-recv-time; font-size: 10px; }
                Text { text: last-recv-data; font-size: 10px; }
            }
        }

        HorizontalLayout {
            Text { text: "Sent: " + bytes-sent + " bytes"; font-size: 10px; }
            Text { text: "Recv: " + bytes-recv + " bytes"; font-size: 10px; }
        }
    }
}

export component MainWindow inherits Window {
    title: "TCSpecial MOC";
    min-width: 800px;
    min-height: 600px;
    background: white;

    in-out property <string> ci-status: "Disconnected";
    in-out property <string> ci-address: "127.0.0.1:4000";
    in-out property <string> last-response: "";
    in-out property <string> beacon-time: "--:--:--";

    // DH properties
    in-out property <string> dh0-status: "Stopped";
    in-out property <string> dh0-last-sent: "";
    in-out property <string> dh0-last-recv: "";
    in-out property <int> dh0-bytes-sent: 0;
    in-out property <int> dh0-bytes-recv: 0;

    in-out property <string> dh1-status: "Stopped";
    in-out property <string> dh1-last-sent: "";
    in-out property <string> dh1-last-recv: "";
    in-out property <int> dh1-bytes-sent: 0;
    in-out property <int> dh1-bytes-recv: 0;

    in-out property <string> dh2-status: "Stopped";
    in-out property <string> dh2-last-sent: "";
    in-out property <string> dh2-last-recv: "";
    in-out property <int> dh2-bytes-sent: 0;
    in-out property <int> dh2-bytes-recv: 0;

    in-out property <string> dh3-status: "Stopped";
    in-out property <string> dh3-last-sent: "";
    in-out property <string> dh3-last-recv: "";
    in-out property <int> dh3-bytes-sent: 0;
    in-out property <int> dh3-bytes-recv: 0;

    callback connect-clicked();
    callback disconnect-clicked();
    callback ping-clicked();
    callback query-all-clicked();
    callback start-dh(int);
    callback stop-dh(int);
    callback quit-clicked();

    VerticalLayout {
        padding: 10px;
        spacing: 10px;

        // CI Control Section
        GroupBox {
            title: "Command Interpreter";

            VerticalLayout {
                spacing: 8px;

                HorizontalLayout {
                    spacing: 8px;
                    Text { text: "Address:"; vertical-alignment: center; }
                    LineEdit {
                        text <=> ci-address;
                        min-width: 150px;
                    }
                    Button {
                        text: "Connect";
                        clicked => { connect-clicked(); }
                    }
                    Button {
                        text: "Disconnect";
                        clicked => { disconnect-clicked(); }
                    }
                    Text {
                        text: "Status: " + ci-status;
                        color: ci-status == "Connected" ? #008000 : #ff0000;
                        vertical-alignment: center;
                    }
                }

                HorizontalLayout {
                    spacing: 8px;
                    Button {
                        text: "Ping";
                        clicked => { ping-clicked(); }
                    }
                    Button {
                        text: "Query All DHs";
                        clicked => { query-all-clicked(); }
                    }
                    Text { text: "Last Beacon: " + beacon-time; vertical-alignment: center; }
                }

                HorizontalLayout {
                    Text { text: "Last Response: " + last-response; font-size: 11px; }
                }
            }
        }

        // Data Handlers Section
        GroupBox {
            title: "Data Handlers";
            height: 600px;

            ScrollView {
                height: 600px;
                GridBox {
                    spacing: 10px;
                    height: 700px;

                    Row {
                        DHPanel {
                            dh-name: "DH0";
                            dh-config: "TCP localhost:5000";
                            dh-status: dh0-status;
                            packet-size: 12;
                            packet-interval: 1000;
                            last-sent-data: dh0-last-sent;
                            last-recv-data: dh0-last-recv;
                            bytes-sent: dh0-bytes-sent;
                            bytes-recv: dh0-bytes-recv;
                            start-clicked => { start-dh(0); }
                            stop-clicked => { stop-dh(0); }
                        }

                        DHPanel {
                            dh-name: "DH1";
                            dh-config: "UDP localhost:5001";
                            dh-status: dh1-status;
                            packet-size: 11;
                            packet-interval: 1000;
                            last-sent-data: dh1-last-sent;
                            last-recv-data: dh1-last-recv;
                            bytes-sent: dh1-bytes-sent;
                            bytes-recv: dh1-bytes-recv;
                            start-clicked => { start-dh(1); }
                            stop-clicked => { stop-dh(1); }
                        }
                    }

                    Row {
                        DHPanel {
                            dh-name: "DH2";
                            dh-config: "Device /dev/urandom";
                            dh-status: dh2-status;
                            packet-size: 1;
                            packet-interval: 0;
                            last-sent-data: dh2-last-sent;
                            last-recv-data: dh2-last-recv;
                            bytes-sent: dh2-bytes-sent;
                            bytes-recv: dh2-bytes-recv;
                            start-clicked => { start-dh(2); }
                            stop-clicked => { stop-dh(2); }
                        }

                        DHPanel {
                            dh-name: "DH3";
                            dh-config: "UDP localhost:5003";
                            dh-status: dh3-status;
                            packet-size: 15;
                            packet-interval: 500;
                            last-sent-data: dh3-last-sent;
                            last-recv-data: dh3-last-recv;
                            bytes-sent: dh3-bytes-sent;
                            bytes-recv: dh3-bytes-recv;
                            start-clicked => { start-dh(3); }
                            stop-clicked => { stop-dh(3); }
                        }
                    }
                }
            }
        }

        // Quit Button
        HorizontalLayout {
            Rectangle { }
            Button {
                text: "Quit";
                clicked => { quit-clicked(); }
            }
        }
    }
}
