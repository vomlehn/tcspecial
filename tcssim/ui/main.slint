import { Button, GroupBox, LineEdit, VerticalBox, HorizontalBox, SpinBox, ScrollView, GridBox } from "std-widgets.slint";

component PayloadPanel inherits Rectangle {
    in property <string> payload-name: "Payload 0";
    in property <string> payload-config: "TCP localhost:5000";
    in property <string> payload-status: "Stopped";
    in-out property <int> packet-size: 12;
    in-out property <int> segment-size: 12;
    in-out property <int> packet-interval: 1000;
    in-out property <int> segment-interval: 1000;
    in property <string> last-sent-time: "--:--:--";
    in property <string> last-sent-data: "";
    in property <string> last-recv-time: "--:--:--";
    in property <string> last-recv-data: "";
    in property <int> packets-sent: 0;
    in property <int> packets-recv: 0;

    callback start-clicked();
    callback stop-clicked();
    callback config-changed();

    background: #f0f0f0;
    border-color: #808080;
    border-width: 1px;
    min-height: 200px;  // Much smaller

    VerticalLayout {
        padding: 4px;
        spacing: 2px;

        // Header row - combine name and status
        HorizontalLayout {
            spacing: 4px;
            height: 18px;
            Text {
                text: payload-name;
                font-size: 11px;
                font-weight: 700;
                vertical-alignment: top;
            }
            Text {
                text: payload-status;
                font-size: 11px;
                font-weight: payload-status == "Running" ? 400 : 700;
                vertical-alignment: top;
                color: payload-status == "Running" ? black : red;
            }
        }

        HorizontalLayout {
            spacing: 4px;
            height: 18px;
            Text {
                text: "Config: " + payload-config;
                font-size: 9px;
                vertical-alignment: top;
            }
        }

        // Combine multiple inputs on same row
        HorizontalLayout {
            height: 22px;
            spacing: 0px;
            Text { text: "Pkt:"; vertical-alignment: top; font-size: 9px; }
            SpinBox {
                value <=> packet-size;
                minimum: 1;
                maximum: 32;
                edited => { config-changed(); }
            }
            Text { text: "Seg:"; vertical-alignment: top; font-size: 9px; }
            SpinBox {
                value <=> segment-size;
                minimum: 1;
                maximum: 32;
                edited => { config-changed(); }
            }
        }

        HorizontalLayout {
            height: 22px;
            spacing: 0px;
            Text { text: "Pkt Int:"; vertical-alignment: top; font-size: 9px; }
            SpinBox {
                value <=> packet-interval;
                minimum: 0;
                maximum: 10000;
                edited => { config-changed(); }
            }
            Text { text: "Seg Int:"; vertical-alignment: top; font-size: 9px; }
            SpinBox {
                value <=> segment-interval;
                minimum: 0;
                maximum: 10000;
                edited => { config-changed(); }
            }
        }

        HorizontalLayout {
            height: 24px;
            spacing: 2px;
            Button {
                text: "Start";
                clicked => { start-clicked(); }
            }
            Button {
                text: "Stop";
                clicked => { stop-clicked(); }
            }
        }

        // Compact stats
        HorizontalLayout {
            height: 14px;
            Text { text: "Sent: " + last-sent-time + " " + last-sent-data; font-size: 9px; }
        }
        HorizontalLayout {
            height: 14px;
            Text { text: "Recv: " + last-recv-time + " " + last-recv-data; font-size: 9px; }
        }
        HorizontalLayout {
            height: 14px;
            Text { text: "Pkts: " + packets-sent + " sent / " + packets-recv + " recv"; font-size: 9px; }
        }
    }
}

export component MainWindow inherits Window {
    title: "TCSpecial Payload Simulator";
    min-width: 800px;
    min-height: 600px;
    background: white;

    // Payload 0 properties
    in-out property <string> p0-status: "Stopped";
    in-out property <int> p0-packet-size: 12;
    in-out property <int> p0-segment-size: 12;
    in-out property <int> p0-packet-interval: 1000;
    in-out property <int> p0-segment-interval: 1000;
    in-out property <string> p0-last-sent-time: "--:--:--";
    in-out property <string> p0-last-sent-data: "";
    in-out property <string> p0-last-recv-time: "--:--:--";
    in-out property <string> p0-last-recv-data: "";
    in-out property <int> p0-packets-sent: 0;
    in-out property <int> p0-packets-recv: 0;

    // Payload 1 properties
    in-out property <string> p1-status: "Stopped";
    in-out property <int> p1-packet-size: 11;
    in-out property <int> p1-segment-size: 11;
    in-out property <int> p1-packet-interval: 1000;
    in-out property <int> p1-segment-interval: 1000;
    in-out property <string> p1-last-sent-time: "--:--:--";
    in-out property <string> p1-last-sent-data: "";
    in-out property <string> p1-last-recv-time: "--:--:--";
    in-out property <string> p1-last-recv-data: "";
    in-out property <int> p1-packets-sent: 0;
    in-out property <int> p1-packets-recv: 0;

    // Payload 2 properties
    in-out property <string> p2-status: "Stopped";
    in-out property <int> p2-packet-size: 1;
    in-out property <int> p2-segment-size: 1;
    in-out property <int> p2-packet-interval: 0;
    in-out property <int> p2-segment-interval: 0;
    in-out property <string> p2-last-sent-time: "--:--:--";
    in-out property <string> p2-last-sent-data: "";
    in-out property <string> p2-last-recv-time: "--:--:--";
    in-out property <string> p2-last-recv-data: "";
    in-out property <int> p2-packets-sent: 0;
    in-out property <int> p2-packets-recv: 0;

    // Payload 3 properties
    in-out property <string> p3-status: "Stopped";
    in-out property <int> p3-packet-size: 15;
    in-out property <int> p3-segment-size: 15;
    in-out property <int> p3-packet-interval: 500;
    in-out property <int> p3-segment-interval: 500;
    in-out property <string> p3-last-sent-time: "--:--:--";
    in-out property <string> p3-last-sent-data: "";
    in-out property <string> p3-last-recv-time: "--:--:--";
    in-out property <string> p3-last-recv-data: "";
    in-out property <int> p3-packets-sent: 0;
    in-out property <int> p3-packets-recv: 0;

    callback start-payload(int);
    callback stop-payload(int);
    callback config-payload(int, int, int, int, int);
    callback quit-clicked();

    VerticalLayout {
        padding: 0px;
        spacing: 0px;

        Text {
            text: "Simulated Payloads";
            font-size: 18px;
            font-weight: 700;
            horizontal-alignment: center;
        }

        ScrollView {
            GridBox {
                spacing: 0px;
                height: 300px;

                Row {
                    PayloadPanel {
                        payload-name: "Payload 0 (DH0)";
                        payload-config: "TCP localhost:5000";
                        payload-status: p0-status;
                        packet-size <=> p0-packet-size;
                        segment-size <=> p0-segment-size;
                        packet-interval <=> p0-packet-interval;
                        segment-interval <=> p0-segment-interval;
                        last-sent-time: p0-last-sent-time;
                        last-sent-data: p0-last-sent-data;
                        last-recv-time: p0-last-recv-time;
                        last-recv-data: p0-last-recv-data;
                        packets-sent: p0-packets-sent;
                        packets-recv: p0-packets-recv;
                        start-clicked => { start-payload(0); }
                        stop-clicked => { stop-payload(0); }
                        config-changed => { config-payload(0, p0-packet-size, p0-segment-size, p0-packet-interval, p0-segment-interval); }
                    }

                    PayloadPanel {
                        payload-name: "Payload 1 (DH1)";
                        payload-config: "UDP localhost:5001";
                        payload-status: p1-status;
                        packet-size <=> p1-packet-size;
                        segment-size <=> p1-segment-size;
                        packet-interval <=> p1-packet-interval;
                        segment-interval <=> p1-segment-interval;
                        last-sent-time: p1-last-sent-time;
                        last-sent-data: p1-last-sent-data;
                        last-recv-time: p1-last-recv-time;
                        last-recv-data: p1-last-recv-data;
                        packets-sent: p1-packets-sent;
                        packets-recv: p1-packets-recv;
                        start-clicked => { start-payload(1); }
                        stop-clicked => { stop-payload(1); }
                        config-changed => { config-payload(1, p1-packet-size, p1-segment-size, p1-packet-interval, p1-segment-interval); }
                    }
                }

                Row {
                    PayloadPanel {
                        payload-name: "Payload 2 (DH2)";
                        payload-config: "Device /dev/urandom";
                        payload-status: p2-status;
                        packet-size <=> p2-packet-size;
                        segment-size <=> p2-segment-size;
                        packet-interval <=> p2-packet-interval;
                        segment-interval <=> p2-segment-interval;
                        last-sent-time: p2-last-sent-time;
                        last-sent-data: p2-last-sent-data;
                        last-recv-time: p2-last-recv-time;
                        last-recv-data: p2-last-recv-data;
                        packets-sent: p2-packets-sent;
                        packets-recv: p2-packets-recv;
                        start-clicked => { start-payload(2); }
                        stop-clicked => { stop-payload(2); }
                        config-changed => { config-payload(2, p2-packet-size, p2-segment-size, p2-packet-interval, p2-segment-interval); }
                    }

                    PayloadPanel {
                        payload-name: "Payload 3 (DH3)";
                        payload-config: "UDP localhost:5003";
                        payload-status: p3-status;
                        packet-size <=> p3-packet-size;
                        segment-size <=> p3-segment-size;
                        packet-interval <=> p3-packet-interval;
                        segment-interval <=> p3-segment-interval;
                        last-sent-time: p3-last-sent-time;
                        last-sent-data: p3-last-sent-data;
                        last-recv-time: p3-last-recv-time;
                        last-recv-data: p3-last-recv-data;
                        packets-sent: p3-packets-sent;
                        packets-recv: p3-packets-recv;
                        start-clicked => { start-payload(3); }
                        stop-clicked => { stop-payload(3); }
                        config-changed => { config-payload(3, p3-packet-size, p3-segment-size, p3-packet-interval, p3-segment-interval); }
                    }
                }
            }
        }

        HorizontalLayout {
            Rectangle { }
            Button {
                text: "Quit All";
                clicked => { quit-clicked(); }
            }
        }
    }
}
